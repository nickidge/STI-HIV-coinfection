
timepars_raw = read_excel("data_sti.xlsx", sheet="timepars", col_names = F)
timepars_raw = as.data.frame(timepars_raw)

timepars_col = ncol(timepars_raw)
timepars_row = nrow(timepars_raw)

t_dat = timepars_raw[4:timepars_row,1]
t_dat = as.numeric(unlist(t_dat))
baselist = list()
for(col in 2:timepars_col){
# for(col in 2:24){
  parname = timepars_raw[1,col]
  pop = timepars_raw[2,col]
  subpop = timepars_raw[3,col]
  y = as.numeric(timepars_raw[4:timepars_row, col])
  
  thispar = modelpar(t=t_dat, y=y, parname=parname, pop=pop, subpop=subpop, tvec=tvec_base)
  thisname = thispar$refvar
  thiscol = thispar$col
  
  if(!(thisname %in% names(baselist))){
    baselist[[thisname]] = matrix(NA, nrow = length(tvec_base), ncol = thispar$maxcol,
                                  dimnames = list(tvec_base, 1:thispar$maxcol))
  }
  colnames(baselist[[thisname]])[thiscol] = paste(parname, pop, subpop, sep='__')
  
  if(thispar$getbase){
    if(thisname %in% names(defaultlist)){
      baselist[[thisname]][1,thiscol] = defaultlist$thisname[thiscol]
    } else if(paste0(thisname, '_interp') %in% names(defaultlist)){
      tempname = paste0(thisname, '_interp')
      baselist[[thisname]][,thiscol] = defaultlist[[tempname]][,thiscol]
    } else {
      print(paste0("Variable '", thisname, "' not in defaultlist at all"))
    }
  } else {
    baselist[[thisname]][,thiscol] = thispar$v
  }
 
}

baselist = fill_list(baselist, deflist = defaultlist)
