plot_years = c(2010, 2022)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
source("f_uncertainty.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
source("calibrate.R", echo = T)
source("scenarios.R", echo = T)
source("uncertainty.R", echo = T)
scen_df
p = plot_df(scen_df)
p
p = p + scale_colour_manual(limits = c('Data', scen_long_names), values=c('black', 'black', 'red', 'green'))
p
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
this_scen_trials$lower_ci
thisdf$type
nrow(thisdf)
nrow(this_scen_trials)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
exists('cal')
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
source("f_uncertainty.R", echo = F)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
exists('cal')
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
}
source("scenarios.R", echo = T)
source("uncertainty.R", echo = T)
View(this_scen_trials)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
tvec_base
cal
cal$SID[2015,,,]
cal$SID[2015,,]
cal$SID["2015",,,]
t
dt
y0_split = cal$SID[as.character(split_year - dt),,,]
split_year = 2015
y0_split = cal$SID[as.character(split_year - dt),,,]
y0_split
get
getdict
getdict = function(list, key, default){
if(key %in% names(list)){
return(list[[key]])
} else {
return(default)
}
}
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
split_year = 2015
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
source("f_uncertainty.R", echo = F)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
}
y0_split = cal$SID[as.character(split_year - dt),,,]
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
run_model
tvec_base
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
View(this_scen_trials)
View(this_scen_trials)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?scale_colour_manual
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
thisscen
ci_df(ntrials=10, timepars=thisscen, basevar=0.1, tvec=tvec_split, y0=y0_split)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
thisscen = load_time_par_sheet(scen_sheet_names[s], deflist = baselist)
s
scen_sheet_names[s]
load_time_par_sheet(scen_sheet_names[s], deflist = baselist)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
thisscen = load_time_par_sheet(scen_sheet_names[s], deflist = baselist)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
thispar
parname
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
deflist[[parname]]
parname
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
split_year = 2015
tvec_split = tvec_base[tvec_base >= split_year]
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
source("f_uncertainty.R", echo = F)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
}
y0_split = cal$SID[as.character(split_year - dt),,,]
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
prevdt
thispopsize
sum(y0)
popsize
y0_split
sum(y0_split)
thispopsize
options
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
split_year = 2015
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
source("f_uncertainty.R", echo = F)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
}
source("scenarios.R", echo = T)
source("uncertainty.R", echo = T)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
!getdict(options, 'static', FALSE)
options
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
matrix(c(1,2,3,4), nrow=2)
matrix(c(1,2,3,4), nrow=2)[,2]
tvec_base
syear < tvec_base < syear + 1
syear < tvec_base & tvec_base < syear + 1
?approx
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
split_year = 2014
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
# function scripts
source("f_uncertainty.R", echo = F)
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
}
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
vl
vh
syear
vl[syear]
names(vl)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
vm
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
timepars[[ind]]
multyears
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
multyears
timepars[[ind]]
timepars[[ind]]
timepars[[ind]]
timepars[[ind]]
timepars[[ind]]
timepars[[ind]]
ind
matrix(c(1,2,3,4), nrow=2)
length(matrix(c(1,2,3,4), nrow=2))
source('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
key
modelpars[[key]]
TT
asub(modelpars[[key]], TT, 1)
split_year
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?approx
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
as.character(split_year - dt)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
thisscen[laply(names(thisscen), function(x) !identical(thisscen[[x]], baselist[[x]]))]
diffscens = thisscen[laply(names(thisscen), function(x) !identical(thisscen[[x]], baselist[[x]]))]
diffscens
str(diffscens)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
this_scen_trials
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
?facet_wrap
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
p = plot_df(widen_sources(all_dat, extr(cal, output_keys)))
saveopen(p, 'calibration', 'plots')
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
syear
thispar$getbase
baselist
View(add_data_col)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
tempfunc = function(x = ttttt) sum(x)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
scen_df
?var
?vars
!!'value'
!!('value')
"!!"('value')
source('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/uncertainty.R', echo=TRUE)
warnings()
?rlang
as.symbole
as.symbol
?sym
source('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/uncertainty.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
this_df
thisdf
this_scen_trials
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
df
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
outlist
baselist$init_PLHIV
source("pars.R", echo = F)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
df
df$trial
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
this_scen_trials
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df
this_scen_trials
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df$t
scen_df$value
scen_df$lower_ci
scen_keys = c('PLHIV', 'HIV_diag', 'HIV_inf')
dat = all_dat
dat$scen = 'data'
dat = widen_sources(dat)
scen_df = ci_df(5, basevar=0.2)
# scen_df = extr(cal, scen_keys)
# scen_df = widen_sources(scen_df)
scen_df$scen = 'base'
scen_df = rbind.fill(scen_df, dat)
scen_df
scen_keys = c('PLHIV', 'HIV_diag', 'HIV_inf')
dat = all_dat
dat$scen = 'data'
dat = widen_sources(dat)
scen_df = ci_df(5, basevar=0.2)
# scen_df = extr(cal, scen_keys)
scen_df = widen_sources(scen_df)
scen_df$scen = 'base'
scen_df = rbind.fill(scen_df, dat)
scen_df
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/loadpars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/loadpars.R', echo=TRUE)
prop_diag0
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?function
population_value = static_pars$population_value$v
growth = static_pars$growth$v
population_year = static_pars$population_year$v
population_est = function(years) population_value * (1 + growth)^( 12 * (years - population_year))
popsize_t = seq(1990, 2050, by=1/12)
popsize = setNames(population_est(years), popsize_t)
popsize = setNames(population_est(popsize_t), popsize_t)
popsize
population_est = function(years) setNames(population_value * (1 + growth)^( 12 * (years - population_year)), year)
popsize_t = seq(1990, 2050, by=1/12)
popsize = population_est(popsize_t)
population_est = function(years) setNames(population_value * (1 + growth)^( 12 * (years - population_year)), years)
popsize_t = seq(1990, 2050, by=1/12)
popsize = population_est(popsize_t)
popsize
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
prevdt[c('S_hi', 'S_pr'),,]
get_movement(c('S_hi', 'S_pr'), HIV_trans)
apply(prevdt[c('S_hi', 'S_pr'),,], 1, sum)
apply(prevdt[c('S_hi', 'S_pr'),,], c(2,3), sum)
apply(prevdt[c('S_hi', 'S_pr'),,], c(2,3), sum) + get_movement(c('S_hi', 'S_pr'), HIV_trans)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
s_lo
s_hi
(sum(s_lo + s_hi) * prop_high_risk - sum(s_hi)) / sum(s_lo) * s_lo
HIV_trans['become_high_risk',,]
HIV_trans['become_high_risk',,] = (sum(s_lo + s_hi) * prop_high_risk - sum(s_hi)) / sum(s_lo) * s_lo
# calculate risk transitions
s_lo = prevdt['S_lo',,] + get_movement('S_lo', HIV_trans)
s_hi = apply(prevdt[c('S_hi', 'S_pr'),,], c(2,3), sum) + get_movement(c('S_hi', 'S_pr'), HIV_trans)
HIV_trans['become_high_risk',,] = (sum(s_lo + s_hi) * prop_high_risk - sum(s_hi)) / sum(s_lo) * s_lo
# calculate prep transitions
s_hi = prevdt['S_hi',,] + get_movement('S_hi', HIV_trans)
s_pr = prevdt['S_pr',,] + get_movement('S_pr', HIV_trans)
HIV_trans
s_hi
s_pr
num_prep
sum(s_pr)
sum(s_hi + s_pr) <= num_prep
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
prevdt
HIV_trans
s_hi
s_lo
s_pr
s_hi
num_prep
num_prep
s_lo
s_hi
s_hi
s_pr
num_prep
s_pr
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
t
warnings()
s_pr
s_hi
s_lo
prop_high_risk
HIV_trans
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
s_lo
s_hi
popgrowth * c((1-prop_high_risk), prop_high_risk)
prevdt[c("S_lo", "S_hi"), "S", "lo"]
prevdt[c("S_lo", "S_hi"), "S", "lo"] + popgrowth * c((1-prop_high_risk), prop_high_risk)
get_movement('S_lo', HIV_trans)
HIV_trans
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
num_prep
s_pr
HIV_trans
s_lo
prevdt['S_lo',,]
get_movement('S_lo', HIV_trans)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
tvec_base = seq(2007, 2025, by=1/12)
plot_years = c(2010, 2022)
split_year = 2014
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
# function scripts
source("f_uncertainty.R", echo = F)
source("f_calibrate.R", echo = F)
# run model and calibrate
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("processing.R", echo=F)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
source("pars.R", echo = F)
}
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
source("calibrate.R", echo = T)
source("pars.R", echo = F)
}
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
