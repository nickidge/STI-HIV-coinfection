popsize
prevdt
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
p = plot_df(scen_df)
scen_df
p = plot_df(scen_df_wide)
p
scen_df
thisdf
res
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
p
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df
s
str(scen_df)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
timepars_raw[,col]
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
thislist
thislist
thislist
thislist
View(add_data_col)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
scen_df = widen_sources(all_dat, res)
scen_df$scen = 'base'
scen_short_names = c('base', 'less_test', 'less_cond')
scen_long_names = c('base', 'less frequent testing', 'less condom usage')
scen_sheet_names = c('timepars', 'scen_1', 'scen_2')
for(s in 2:3){
thisscen = load_time_par_sheet(scen_sheet_names[s], deflist = baselist)
thismodel = run_model(y0_base, modelpars=thisscen)
thisdf = extr(thismodel, output_keys)
thisdf = widen_sources(all_dat, thisdf)
thisdf$scen = scen_short_names[s]
thisdf$data = NA
scen_df = rbind(scen_df, thisdf)
}
scen_df$t = as.numeric(as.character(scen_df$t))
p = plot_df(scen_df)
p
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
defaultlist$eff_condom
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
defaultlist$risk_mat
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
saveopen(p)
getwd()
saveopen = function(p, fname='untitled', fdir='/', ext='pdf', ...){
pdfname = paste0(fname, '.', ext)
fpath = file.path(getwd(), fdir)
ggsave(pdfname, plot=p, path=fpath, units = "mm", device=ext, ...)
browseURL(file.path(fpath, pdfname))
}
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
saveopen(p)
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
saveopen(p)
?spread
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
?rbind.fill
?nkmb
?nmkb
debugSource('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
df_wide
debugSource('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
df_wide
norm(df_wide$data, df_wide$model)
c(1, 2, NA) - c(3, 5, NA)
c(1, 2, NA) - c(3, 2, NA)
c(1, 2, NA) - c(3, NA, NA)
?sum
source('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
norm(df_wide$data, df_wide$model)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?spread
df
df_wide
scen_df
scen_df['temp'] = NA
scen_df$temp
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df$order = -(match(scen_df$scen, c('data', scen_short_names)))
scen_df
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df$order
?match
scen_df$scen
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df$order
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
scen_df$order
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
?scale_colour_manual
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
?scale_colour_discrete
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
output_keys
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
tvec_base
popsize_t = seq(1990, 2050, by=1/12)
popsize = setNames(unlist(lapply(popsize_t, function(x) population_value * (1 + growth)^( 12 * (x - population_year)))), popsize_t)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
calibrationvars = c('f_infect_HIV', 'init_PLHIV', 'init_diag_prop')
defaultlist[[calibrationvars]]
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
uncal = run_model(y0_base, tvec_base, modelpars=baselist)
source("calibrate.R", echo = T)
source('~/GitHub/STI-HIV-coinfection/calibrate.R', echo=TRUE)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
# uncal = run_model(y0_base, tvec_base, modelpars=baselist)
source("calibrate.R", echo = T)
source("scenarios.R", echo = T)
thisscen
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
# uncal = run_model(y0_base, tvec_base, modelpars=baselist)
source("calibrate.R", echo = T)
source("scenarios.R", echo = T)
source("scenarios.R", echo = T)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?saveopen
saveopen
p = plot_calibration(cal, all_dat)
saveopen(p, 'calibration', 'plots')
source('~/GitHub/STI-HIV-coinfection/plotting.R', echo=TRUE)
p = plot_df(scen_df)
p = p + scale_colour_manual(limits = c('Data', scen_long_names), values=c('black', 'black', 'red', 'green'))
saveopen(p, 'scenarios', 'plots')
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
thisscen
thisscen$risk_mat
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
thisscen$risk_mat
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
thislist
debugSource('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
thispar
thispar
notnas
i
View(load_time_par_sheet)
source('~/GitHub/STI-HIV-coinfection/pars.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
output_keys
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("processing.R", echo=F)
source("calibrate.R", echo = T)
source("scenarios.R", echo = T)
popsize[TT]
TT
prevdt
prevdt[,1,1]
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
calibrate.R
source("calibrate.R", echo = T)
prevdt
HIV_trans
# calculate prep transitions
s_hi = prevdt['S_hi',,] - HIV_trans['S_hi_inf']
s_hi
HIV_trans['S_hi_inf']
# calculate prep transitions
s_hi = prevdt['S_hi',,] - HIV_trans['S_hi_inf',,]
s_hi
s_pr = prevdt['S_pr',,] - HIV_trans['S_pr_inf',,]
s_pr
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
?nmkb
source('~/GitHub/STI-HIV-coinfection/main.R', echo=TRUE)
cal
cal$HIV_trans_log
cal$HIV_trans_log['start_prep']
cal$HIV_trans_log[,'start_prep']
cal$HIV_trans_log[,'start_prep',,]
cal$HIV_trans_log[,'start_prep',,'lo']
cal$HIV_trans_log[,'start_prep','S','lo']
cal$SID
cal$SID[,,,]
cal$SID[,,'S','lo']
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("calibrate.R", echo = T)
HIV_trans
HIV_transitions
1:nrow(HIV_transitions)
HIV_trans
x = 1
HIV_transitions$trans[x]
FALSE - TRUE
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("calibrate.R", echo = T)
apply(1:nrow(HIV_transitions), function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == 'S_hi') - (HIV_transitions[x, "from"] == 'S_hi')))
?apply
source("calibrate.R", echo = T)
apply(1:nrow(HIV_transitions), 1, function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == 'S_hi') - (HIV_transitions[x, "from"] == 'S_hi')))
source("calibrate.R", echo = T)
?lapply
lapply(1:nrow(HIV_transitions), function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == 'S_hi') - (HIV_transitions[x, "from"] == 'S_hi')))
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
source("model.R", echo = F)
source("calibrate.R", echo = T)
lapply(1:nrow(HIV_transitions), function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == HIV_compartment) - (HIV_transitions[x, "from"] == HIV_compartment)))
Reduce('+', l)
l = lapply(1:nrow(HIV_transitions), function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == HIV_compartment) - (HIV_transitions[x, "from"] == HIV_compartment)))
Q
source("calibrate.R", echo = T)
l = lapply(1:nrow(HIV_transitions), function(x) HIV_trans[x,,] * ((HIV_transitions[x, "to"] == HIV_compartment) - (HIV_transitions[x, "from"] == HIV_compartment)))
Reduce('+', l)
source('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("processing.R", echo=F)
source("calibrate.R", echo = T)
get_movement('S_hi', HIV_trans)
get_movement('S_pr', HIV_trans)
tvec_base = seq(2007, 2022, by=1/12)
tvec = tvec_base
nt = length(tvec)
source("init.R", echo = F)
source("loadpars.R", echo = F)
source("loadbase.R", echo = F)
source("info.R", echo = F)
source("default_values.R", echo = F)
source("y0.R", echo = F)
source("themes.R", echo = F)
source("plotting.R", echo = F)
source("pars.R", echo = F)
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
# set key dates
last_data_year = as.numeric(tail(data_raw[,1], 1))
end_year = max(tvec_base)
# # load the base scenario and set initial conditions
# source("loadbase.R", echo = F)
# source("sety0.R", echo = F)
# y0 = sety0()
# run model and calibrate
source("model.R", echo = F)
source("processing.R", echo=F)
source("calibrate.R", echo = T)
source("scenarios.R", echo = T)
source('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source('~/GitHub/STI-HIV-coinfection/scenarios.R', echo=TRUE)
