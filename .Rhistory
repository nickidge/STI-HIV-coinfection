# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus'))
}
baselist
model_df = run_model(y0=NULL, tvec=tvec_base, modelpars=baselist, options=options)
model_df = extr(model_df, 'popsize')
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
# saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev'), colour_strat = 'med'), 'calibration1', 'plots')
saveopen(plot_cals(), 'calibration', 'plots', width=2*0.9*page_width)
baselist$init_prev_HIV_aus
baselist$init_prev_HIV_int
model_df
subset(model_df, HIV_pop == 'S_lo' & med_pop == 'int')
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
model_df = run_model(y0=NULL, tvec=tvec_base, modelpars=baselist, options=options)
foi_HIV
int_factor
Q
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
model_df = run_model(y0=NULL, tvec=tvec_base, modelpars=baselist, options=options)
model_df = extr(model_df, 'popsize')
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
# saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev'), colour_strat = 'med'), 'calibration1', 'plots')
saveopen(plot_cals(), 'calibration', 'plots', width=2*0.9*page_width)
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
# model_df = run_model(y0=NULL, tvec=tvec_base, modelpars=baselist, options=options)
# model_df = extr(model_df, 'popsize')
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
# saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev'), colour_strat = 'med'), 'calibration1', 'plots')
saveopen(plot_cals(), 'calibration', 'plots', width=2*0.9*page_width)
baselist$int_factor
sHIV$pr
HIV_labs
?union
sHIV[['und']] = setdiff(HIV_labs, sHIV$D)
sHIV[['und']]
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
thisprevall
thisprev
sHIV[['S_pr']] = 'S_pr'
sHIV$S_pr
sHIV$S
plot_keys
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
# model_df = run_model(y0=NULL, tvec=tvec_base, modelpars=baselist, options=options)
# model_df = extr(model_df, 'popsize')
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev', 'prop_prep'), colour_strat = 'med'), 'calibration1', 'plots')
# saveopen(plot_cals(), 'calibration', 'plots', width=2*0.9*page_width)
source('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
thisprepall
thistotpopall
sHIV$S_pr
sHIV$S
thisprepall = apply(this[,sHIV$S_pr,,], c(1,3), sum)
thistotpopall = apply(this[,sHIV$S,,], c(1,4), sum)
thisprepall
thistotpopall
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev', 'prop_prep'), colour_strat = 'med'), 'calibration1', 'plots')
# saveopen(plot_cals(), 'calibration', 'plots', width=2*0.9*page_width)
base_df
unique(base_df$plot)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
df
thisdf
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
thisdf
df
tail(df)
source('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev', 'prop_prep'), colour_strat = 'med'), 'calibration1', 'plots')
toplot
df$plot
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/f_uncertainty.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
subset(df, plot == 'prop_prep')
unique(df$plot)
source('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
saveopen(plot_uncertainty(base_df, toplot=c('pop', 'PLHIV', 'HIV_diag', 'HIV_inf', 'HIV_prev', 'prop_prep'), colour_strat = 'med'), 'calibration1', 'plots')
View(plot_uncertainty)
HIV_transitions
debugSource('~/GitHub/STI-HIV-coinfection/processing.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# run base scenario (with uncertainty)
base_df = gen_uncertainty(2)
l
Reduce('+', l)
View(get_movement)
View(run_model)
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
prevdt
s_hi
s_pr
Q
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
Q
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
Q
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
s_pr
num_prep
num_prep[i]
s_pr
s_hi
prevdt
num_prep
popsize
baselist$prop_high_risk
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
prop_high_risk
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
modelpars$prop_high_risk
modelpars$prop_high_risk[tvec[1],1]
tvec[1]
modelpars$prop_high_risk[as.character(tvec[1]),1]
med_labs
modelpars$num_prep
# base model information
tvec_base = seq(2007, 2030, by=1/12)
plot_years = c(2007, 2030)
split_year = 2014
# scenario details (names, tab in data_sti.xlsx)
scenarios = list(list(sheet = 'scen_1',
short = 'no_prep',
long = 'Everyone stops using PrEP'),
list(sheet = 'scen_2',
short = 'more_test',
long = 'Testing more often'))
# bulk of code
source("init.R", echo = F)
source("info.R", echo = F)
source("processing.R", echo=F)
source("plotting.R", echo = F)
source("themes.R", echo = F)
source("pars.R", echo = F)
source("loadpars.R", echo = F)
source("default_values.R", echo = F)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
prevdt
hto
hfrom
hpop
hp
t
num_prep
HIV_trans
thisname
HIV_trans[thisname,,]
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
t
num_prep
sum(s_pr) == num_prep[i]
sum(s_pr) > num_prep[i]
(num_prep[i] - sum(s_pr)) / sum(s_pr) * s_pr
num_prep
s_pr
num_prep
sum(s_pr)
num_prep[i]
i
prevdt['S_hi',,i] + get_movement('S_hi', HIV_trans, med=i)
prevdt['S_pr',,i] + get_movement('S_pr', HIV_trans, med=i)
sum(s_pr)
prevdt['S_pr',,i] + get_movement('S_pr', HIV_trans, med=i)
s_pr
get_movement('S_pr', HIV_trans, med=i)
prevdt['S_pr',,i]
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
d
# if(any(is.na(d))){
#   print('')
# }
return(d)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
# calibrate model
if(!exists('cal')){
baselist = load_time_par_sheet('timepars', deflist = defaultlist)
cal_keys = c('PLHIV', 'HIV_diag', 'care_cascade')
gen_calibration(c('f_infect_HIV', 'init_prev_HIV_aus', 'int_factor'))
}
thisname
HIV_trans
t
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
source("model.R", echo = F)
# function scripts
source("f_calibrate.R", echo = F)
source("f_uncertainty.R", echo = F)
source("f_scenarios.R", echo = F)
source("f_table.R", echo = F)
debugSource('~/GitHub/STI-HIV-coinfection/model.R', echo=TRUE)
